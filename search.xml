<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>苹果应用上架appstore流程</title>
    <url>/2017/02/11/apple/2017-02-10-appstore-connect.html</url>
    <content><![CDATA[<h5 id="必要的准备"><a href="#必要的准备" class="headerlink" title="必要的准备"></a>必要的准备</h5><ul>
<li>苹果开发者账号</li>
<li>最新的Xcode</li>
</ul>
<h5 id="开发者发布证书、AppID和描述文件的配置"><a href="#开发者发布证书、AppID和描述文件的配置" class="headerlink" title="开发者发布证书、AppID和描述文件的配置"></a>开发者发布证书、AppID和描述文件的配置</h5><ul>
<li>登录开发者中心创建开发者证书、发布正书、AppId、开发者设备调试绑定、描述文件等</li>
</ul>
<h5 id="通过xcode将构建版本上传到appstore"><a href="#通过xcode将构建版本上传到appstore" class="headerlink" title="通过xcode将构建版本上传到appstore"></a>通过xcode将构建版本上传到appstore</h5><h5 id="进入iTunes-Connect提交app信息"><a href="#进入iTunes-Connect提交app信息" class="headerlink" title="进入iTunes Connect提交app信息"></a>进入iTunes Connect提交app信息</h5><h5 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h5><ul>
<li><a href="https://www.jianshu.com/p/e5ac7b05750a">iOS最新应用上架App Store流程</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/141191661">iOS上架App Store最详细流程</a></li>
</ul>
]]></content>
      <categories>
        <category>apple</category>
      </categories>
      <tags>
        <tag>apple</tag>
      </tags>
  </entry>
  <entry>
    <title>win10系统安装使用docker</title>
    <url>/2022/11/22/docker/2022-11-22-docker-for-win10.html</url>
    <content><![CDATA[<h5 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h5><ul>
<li><p>Docker Desktop </p>
<h6 id="官网地址-https-www-docker-com"><a href="#官网地址-https-www-docker-com" class="headerlink" title="官网地址 (https://www.docker.com/)"></a>官网地址 (<a href="https://www.docker.com/">https://www.docker.com/</a>)</h6></li>
<li><p>电脑bios开启支持vt虚拟化</p>
</li>
<li><p>win10系统开启wsl(建议)或者hyper-v, 搜索栏搜启动或关闭windows功能, 设置好后重启电脑</p>
</li>
</ul>
<h5 id="启动docker-配置阿里云镜像加速-然后重启docker"><a href="#启动docker-配置阿里云镜像加速-然后重启docker" class="headerlink" title="启动docker, 配置阿里云镜像加速, 然后重启docker"></a>启动docker, 配置阿里云镜像加速, 然后重启docker</h5>   <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://qundbw00.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="创建centos8容器"><a href="#创建centos8容器" class="headerlink" title="创建centos8容器"></a>创建<code>centos8</code>容器</h5><ul>
<li><p>拉取<code>centos:8</code>官方镜像</p>
</li>
<li><p><code>powershell</code>管理员命令行执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -itd --volume=C:\Users\wanghuan\Code:/data --name centos8 --privileged centos:8 /usr/sbin/init</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果docker卡住或出现权限问题, <code>powershell</code>管理员命令行执行, 然后重启docker</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;C:\Program Files\Docker\Docker&quot;</span></span><br><span class="line">./DockerCli.exe -SwitchDaemon</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入容器后yum出现<code>Failed to download metadata for repo ‘AppStream’: Cannot prepare internal mirrorlist: No URLs in mirrorlist”</code>错误</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">    <span class="comment"># 进入yum的repos目录</span></span><br><span class="line">    <span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 修改所有的CentOS文件内容</span></span><br><span class="line">    sed -i <span class="string">&#x27;s/mirrorlist/#mirrorlist/g&#x27;</span> /etc/yum.repos.d/CentOS-*</span><br><span class="line">    sed -i <span class="string">&#x27;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#x27;</span> /etc/yum.repos.d/CentOS-*</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 更新yum源为阿里镜像</span></span><br><span class="line">    yum install wget -y</span><br><span class="line">    wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo</span><br><span class="line">    yum clean all</span><br><span class="line">    yum makecache</span><br><span class="line">    ```  </span><br><span class="line"></span><br><span class="line"><span class="comment">##### 安装`lnmp`和`node js`环境</span></span><br><span class="line"></span><br><span class="line">  ```bash</span><br><span class="line">    <span class="comment"># 安装oneinstack</span></span><br><span class="line">    yum -y install epel-release</span><br><span class="line">    yum -y install wget screen</span><br><span class="line">    wget http://mirrors.linuxeye.com/oneinstack-full.tar.gz</span><br><span class="line">    tar xzf oneinstack-full.tar.gz</span><br><span class="line">    <span class="built_in">cd</span> oneinstack</span><br><span class="line">    screen -S oneinstack</span><br><span class="line">    ./install.sh</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重新加载环境变量</span></span><br><span class="line">    <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">    <span class="comment"># nginx</span></span><br><span class="line">    systemctl status nginx.service</span><br><span class="line"></span><br><span class="line">    <span class="comment"># mysql</span></span><br><span class="line">    systemctl status mysqld.service</span><br><span class="line"></span><br><span class="line">    <span class="comment"># php</span></span><br><span class="line">    systemctl status php-fpm.service</span><br></pre></td></tr></table></figure>
<h5 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install git</span><br><span class="line">ssh-keygen -t rsa -C </span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>php</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>github加速</title>
    <url>/2019/01/12/github/2019-01-12-github-proxy.html</url>
    <content><![CDATA[<blockquote>
<p>github</p>
</blockquote>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>  众所周知的原因，github服务器在国外，因为墙的原因，获取包的时候，所以需要配置代理服务。</p>
<h3 id="代理加速"><a href="#代理加速" class="headerlink" title="代理加速"></a>代理加速</h3><ul>
<li><p>梯子一个</p>
</li>
<li><p>配置http协议代理</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 为全局的 git 项目都设置代理(192.168.0.88:7078为代理服务地址)</span></span><br><span class="line">git config --global http.proxy 192.168.0.88:7078</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为某个 git 项目单独设置代理</span></span><br><span class="line">git config --<span class="built_in">local</span> http.proxy 192.168.0.88:7078</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消代理</span></span><br><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br></pre></td></tr></table></figure>
</li>
<li><p>另外还有<code>https</code>和<code>socks5</code>协议的代理, 方法类似.</p>
</li>
</ul>
]]></content>
      <categories>
        <category>github</category>
      </categories>
      <tags>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>go lang入门</title>
    <url>/2017/04/19/golang/2017-04-19-go-install.html</url>
    <content><![CDATA[<blockquote>
<p>go</p>
</blockquote>
<h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><ul>
<li><p><a href="http://books.studygolang.com/gopl-zh/">《The Go Programming Language》中文web版</a></p>
</li>
<li><p><a href="https://astaxie.gitbooks.io/build-web-application-with-golang/content/zh/01.1.html">《Go Web 编程》中文web版</a></p>
</li>
</ul>
<h3 id="centos7环境标准包方式安装和配置"><a href="#centos7环境标准包方式安装和配置" class="headerlink" title="centos7环境标准包方式安装和配置"></a>centos7环境标准包方式安装和配置</h3><ul>
<li><p>如果系统是64,下载64位标准包,否则如果是32位,那么就下载32位标准包。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -O https://golang.org/dl/</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压到安装目录, 如安装到/usr/local目录下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar zvxf go1.16.3.linux-amd64.tar.gz -C /usr/<span class="built_in">local</span>/</span><br></pre></td></tr></table></figure></li>
<li><p>配置环境变量</p>
<ul>
<li><p>打开环境变量配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加配置内容如下(具体的安装目录和工作目录以自己实际的为准)</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">export GOROOT=/usr/local/go</span><br><span class="line">export GOPATH=/var/www/core/go_work</span><br><span class="line">export GOBIN=$GOROOT/bin</span><br><span class="line">export PATH=$GOROOT/bin:$GOPATH/bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新编译加载配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看<code>go env</code> 和 <code>go --version</code>, 看看配置是否生效</p>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>go lang</category>
      </categories>
      <tags>
        <tag>go lang</tag>
      </tags>
  </entry>
  <entry>
    <title>go lang国内加速</title>
    <url>/2017/04/20/golang/2017-04-20-go-proxy.html</url>
    <content><![CDATA[<blockquote>
<p>go</p>
</blockquote>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>  众所周知的原因，go获取包的时候，经常会很慢，使得go的学习成本变高，现在推荐个方法，一步解决这个问题。那就是，goproxy的代理，用完你会发现肉眼可见的变快。</p>
<h3 id="渠道加速"><a href="#渠道加速" class="headerlink" title="渠道加速"></a>渠道加速</h3><ul>
<li>官方(速度慢): <a href="https://proxy.golang.org/">https://proxy.golang.org/</a></li>
<li>Goproxy.io(全球cdn加速): <a href="https://goproxy.io/">https://goproxy.io/</a></li>
<li>七牛云(中国): <a href="https://goproxy.cn/">https://goproxy.cn/</a></li>
</ul>
<h3 id="配置方法"><a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h3><ul>
<li><p>如果你是windows用户，在命令行执行以下命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go env -w GOPROXY=https://goproxy.io,direct</span><br><span class="line">go env -w GO111MODULE=<span class="string">&quot;on&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果你是macOS用户或者linux用户，在/etc/profile文件最后，加入以下代码，保存后执行<code>source /etc/profile</code>生效配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> GO111MODULE=auto</span><br><span class="line"><span class="built_in">export</span> GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>







</li>
</ul>
]]></content>
      <categories>
        <category>go lang</category>
      </categories>
      <tags>
        <tag>go lang</tag>
      </tags>
  </entry>
  <entry>
    <title>go.mod使用</title>
    <url>/2018/12/28/golang/2018-12-28-go-mod.html</url>
    <content><![CDATA[<blockquote>
<p>go.mod是Golang 1.11版本新引入的官方包管理工具用于解决之前没有地方记录依赖包具体版本的问题，方便依赖包的管理</p>
</blockquote>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ul>
<li><p>初始化</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">1. 新建一个目录，并使用go mod init初始化生成 go.mod 文件。</span><br><span class="line">cd go_test</span><br><span class="line">go mod init madoka/go_test.mod</span><br><span class="line"></span><br><span class="line">2. go.mod 文件一旦创建后，它的内容将会被 go toolchain 全面掌控，go toolchain 会在各类命令执行时，比如go get、go build、go mod等修改和维护 go.mod 文件。</span><br><span class="line">3. 列出所有mod, go list -m all, 手动更新mod缓存, go mod tidy</span><br></pre></td></tr></table></figure>











</li>
</ul>
]]></content>
      <categories>
        <category>go lang</category>
      </categories>
      <tags>
        <tag>go lang</tag>
      </tags>
  </entry>
  <entry>
    <title>解决远程mysql数据库无法访问</title>
    <url>/2017/10/12/linux/2017-10-12-mysql-connect.html</url>
    <content><![CDATA[<a id="more"></a>

<h6 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h6><ol>
<li><p>如果是云主机需要放通mysql端口, 一般为3306端口</p>
</li>
<li><p>如果有防火墙, 需要修改规则, 允许访问</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 以centos7为例添加规则允许外界访问3306端口</span></span><br><span class="line">firewall-cmd —zone=public —add-port=3306/tcp —permanent</span><br><span class="line"><span class="comment"># 重启防火墙</span></span><br><span class="line">systemctl restart firewalld.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改mysql权限</p>
<ul>
<li>修改访问规则并刷新规则</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON *.* to &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;ymP1TinRFxpm&#39; WITH GRANT OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<ul>
<li>重启mysql</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl restart mysqld.service</span><br></pre></td></tr></table></figure>




</li>
</ol>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>centos安装和使用supervisor</title>
    <url>/2018/06/21/linux/2018-06-21-supervisor.html</url>
    <content><![CDATA[<h5 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h5><blockquote>
<p>Supervisor是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。它是通过fork/exec的方式把这些被管理的进程当作supervisor的子进程来启动，这样只要在supervisor的配置文件中，把要管理的进程的可执行文件的路径写进去即可。也实现当子进程挂掉的时候，父进程可以准确获取子进程挂掉的信息的，可以选择是否自己启动和报警。supervisor还提供了一个功能，可以为supervisord或者每个子进程，设置一个非root的user，这个user就可以管理它对应的进程。</p>
</blockquote>
<h5 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h5>  <figure class="highlight text"><table><tr><td class="code"><pre><span class="line">supervisor：要安装的软件的名称。</span><br><span class="line">supervisord：装好supervisor软件后，supervisord用于启动supervisor服务。</span><br><span class="line">supervisorctl：用于管理supervisor配置文件中program。</span><br></pre></td></tr></table></figure>
<h5 id="安装supervisor"><a href="#安装supervisor" class="headerlink" title="安装supervisor"></a>安装supervisor</h5>  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo su - <span class="comment">#切换为root用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># yum install epel-release</span></span><br><span class="line"><span class="comment"># yum install -y supervisor</span></span><br><span class="line"><span class="comment"># systemctl enable supervisord # 开机自启动</span></span><br><span class="line"><span class="comment"># systemctl start supervisord # 启动supervisord服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl status supervisord # 查看supervisord服务状态</span></span><br><span class="line"><span class="comment"># ps -ef|grep supervisord # 查看是否存在supervisord进程</span></span><br></pre></td></tr></table></figure>
<h5 id="配置supervisor"><a href="#配置supervisor" class="headerlink" title="配置supervisor"></a>配置supervisor</h5>  <figure class="highlight text"><table><tr><td class="code"><pre><span class="line">[unix_http_server]</span><br><span class="line">file=/tmp/supervisor.sock   ; UNIX socket 文件，supervisorctl 会使用</span><br><span class="line">;chmod=0700                 ; socket 文件的 mode，默认是 0700</span><br><span class="line">;chown=nobody:nogroup       ; socket 文件的 owner，格式： uid:gid</span><br><span class="line"></span><br><span class="line">;[inet_http_server]         ; HTTP 服务器，提供 web 管理界面</span><br><span class="line">;port=127.0.0.1:9001        ; Web 管理后台运行的 IP 和端口，如果开放到公网，需要注意安全性</span><br><span class="line">;username=user              ; 登录管理后台的用户名</span><br><span class="line">;password=123               ; 登录管理后台的密码</span><br><span class="line"></span><br><span class="line">[supervisord]</span><br><span class="line">logfile=/tmp/supervisord.log ; 日志文件，默认是 $CWD/supervisord.log</span><br><span class="line">logfile_maxbytes=50MB        ; 日志文件大小，超出会 rotate，默认 50MB</span><br><span class="line">logfile_backups=10           ; 日志文件保留备份数量默认 10</span><br><span class="line">loglevel=info                ; 日志级别，默认 info，其它: debug,warn,trace</span><br><span class="line">pidfile=/tmp/supervisord.pid ; pid 文件</span><br><span class="line">nodaemon=false               ; 是否在前台启动，默认是 false，即以 daemon 的方式启动</span><br><span class="line">minfds=1024                  ; 可以打开的文件描述符的最小值，默认 1024</span><br><span class="line">minprocs=200                 ; 可以打开的进程数的最小值，默认 200</span><br><span class="line"></span><br><span class="line">; the below section must remain in the config file for RPC</span><br><span class="line">; (supervisorctl/web interface) to work, additional interfaces may be</span><br><span class="line">; added by defining them in separate rpcinterface: sections</span><br><span class="line">[rpcinterface:supervisor]</span><br><span class="line">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span><br><span class="line"></span><br><span class="line">[supervisorctl]</span><br><span class="line">serverurl=unix:///tmp/supervisor.sock ; 通过 UNIX socket 连接 supervisord，路径与 unix_http_server 部分的 file 一致</span><br><span class="line">;serverurl=http://127.0.0.1:9001 ; 通过 HTTP 的方式连接 supervisord</span><br><span class="line"></span><br><span class="line">; 包含其他的配置文件</span><br><span class="line">[include]</span><br><span class="line">files = /etc/supervisor/conf.d/*.conf   ; 可以是 *.conf 或 *.ini</span><br><span class="line">;files = relative/directory/*.ini </span><br></pre></td></tr></table></figure>
<h5 id="将supervisor配置为开机自启动服务"><a href="#将supervisor配置为开机自启动服务" class="headerlink" title="将supervisor配置为开机自启动服务"></a>将supervisor配置为开机自启动服务</h5><ul>
<li><p>编辑服务文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vim /usr/lib/systemd/system/supervisord.service</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>内容如下</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Supervisor daemon</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/var/run/supervisord.pid</span><br><span class="line">ExecStart=/bin/supervisord -c /etc/supervisord.conf</span><br><span class="line">ExecStop=/bin/supervisorctl shutdown</span><br><span class="line">ExecReload=/bin/supervisorctl reload</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=42s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<h5 id="systemctl管理supervisor"><a href="#systemctl管理supervisor" class="headerlink" title="systemctl管理supervisor"></a>systemctl管理supervisor</h5></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># systemctl stop supervisord</span></span><br><span class="line"><span class="comment"># systemctl start supervisord</span></span><br><span class="line"><span class="comment"># systemctl status supervisord</span></span><br><span class="line"><span class="comment"># systemctl reload supervisord</span></span><br><span class="line"><span class="comment"># systemctl restart supervisord</span></span><br><span class="line"><span class="comment"># systemctl enable supervisord</span></span><br><span class="line"><span class="comment"># systemctl is-enabled supervisord</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="supervisor管理监控的进程"><a href="#supervisor管理监控的进程" class="headerlink" title="supervisor管理监控的进程"></a>supervisor管理监控的进程</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看监控的进程服务</span></span><br><span class="line">supervisorctl status</span><br><span class="line"><span class="comment"># 重启queue服务</span></span><br><span class="line">supervisorctl restart queue</span><br><span class="line"><span class="comment"># 停止queue服务</span></span><br><span class="line">supervisorctl stop queue</span><br><span class="line"><span class="comment"># 开启queue服务</span></span><br><span class="line">supervisorctl start queue</span><br></pre></td></tr></table></figure>
<h5 id="queue配置示例"><a href="#queue配置示例" class="headerlink" title="queue配置示例"></a>queue配置示例</h5><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">[program:queue]</span><br><span class="line">command=php think queue:work --queue queue-master --daemon --sleep 2 --tries 3</span><br><span class="line">directory=/data/www/yjy_api/</span><br><span class="line">user=root</span><br><span class="line">stdout_logfile=/data/logs/supervisor/run.log</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br><span class="line">startsecs=60</span><br><span class="line">stopasgroup=true</span><br><span class="line">ikillasgroup=true</span><br><span class="line">startretries=1</span><br><span class="line">redirect_stderr=true</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>supervisor</tag>
      </tags>
  </entry>
  <entry>
    <title>使用vagrant安装centos7虚拟机</title>
    <url>/2019/11/26/linux/2019-11-26-vagrant-centos7.html</url>
    <content><![CDATA[<h5 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h5><ul>
<li><p>vagrant2.2.19_x86_64.msi(<a href="https://releases.hashicorp.com/vagrant/2.2.19/vagrant_2.2.19_x86_64.msi">官方下载地址</a>)</p>
</li>
<li><p>VirtualBox-6.1.32-149290-Win.exe(<a href="https://download.virtualbox.org/virtualbox/6.1.32/VirtualBox-6.1.32-149290-Win.exe">官方下载地址</a>)</p>
</li>
<li><p>CentOS-7-x86_64-Vagrant-2004_01.VirtualBox.box(<a href="http://cloud.centos.org/centos/7/vagrant/x86_64/images/CentOS-7-x86_64-Vagrant-2004_01.VirtualBox.box">官方下载地址</a>)</p>
</li>
</ul>
<h5 id="安装虚拟机"><a href="#安装虚拟机" class="headerlink" title="安装虚拟机"></a>安装虚拟机</h5><ul>
<li><p>添加box</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入box存放目录</span></span><br><span class="line"><span class="built_in">cd</span> ~/vagrant/box</span><br><span class="line"><span class="comment"># 添加box到vagrant</span></span><br><span class="line">vagrant box add centos7 CentOS-7-x86_64-Vagrant-2004_01.VirtualBox.box</span><br><span class="line"><span class="comment"># 查看box列表</span></span><br><span class="line">vagrant box list</span><br></pre></td></tr></table></figure></li>
<li><p>安装vagrant plugin</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看vagrant-vbguest是否安装, 未安装则无法挂载目录进行数据持久化</span></span><br><span class="line">vagrant plugin list</span><br><span class="line"><span class="comment"># 安装0.24版本 </span></span><br><span class="line">vagrant plugin install vagrant-vbguest --plugin-version 0.24</span><br></pre></td></tr></table></figure></li>
<li><p>初始化</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/vagrant</span><br><span class="line">vagrant init</span><br></pre></td></tr></table></figure></li>
<li><p>配置<code>Vagrantfile</code>文件</p>
  <figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -*- mode: ruby -*-</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vi: <span class="built_in">set</span> ft=ruby :</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> All Vagrant configuration is <span class="keyword">done</span> below. The <span class="string">&quot;2&quot;</span> <span class="keyword">in</span> Vagrant.configure</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configures the configuration version (we support older styles <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> backwards compatibility). Please don<span class="string">&#x27;t change it unless you know what</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you<span class="string">&#x27;re doing.</span></span></span><br><span class="line">Vagrant.configure(&quot;2&quot;) do |config|</span><br><span class="line"><span class="meta">  #</span><span class="bash"> The most common configuration options are documented and commented below.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> For a complete reference, please see the online documentation at</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> https://docs.vagrantup.com.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Every Vagrant development environment requires a box. You can search <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> boxes at https://vagrantcloud.com/search.</span></span><br><span class="line">  config.vm.box = &quot;centos7&quot;</span><br><span class="line">  config.vm.hostname = &quot;centos&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Disable automatic box update checking. If you <span class="built_in">disable</span> this, <span class="keyword">then</span></span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> boxes will only be checked <span class="keyword">for</span> updates when the user runs</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> `vagrant box outdated`. This is not recommended.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> config.vm.box_check_update = <span class="literal">false</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Create a forwarded port mapping <span class="built_in">which</span> allows access to a specific port</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> within the machine from a port on the host machine. In the example below,</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> accessing <span class="string">&quot;localhost:8080&quot;</span> will access port 80 on the guest machine.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> NOTE: This will <span class="built_in">enable</span> public access to the opened port</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> config.vm.network <span class="string">&quot;forwarded_port&quot;</span>, guest: 80, host: 8080</span></span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Create a forwarded port mapping <span class="built_in">which</span> allows access to a specific port</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> within the machine from a port on the host machine and only allow access</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> via 127.0.0.1 to <span class="built_in">disable</span> public access</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> config.vm.network <span class="string">&quot;forwarded_port&quot;</span>, guest: 80, host: 8080, host_ip: <span class="string">&quot;127.0.0.1&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Create a private network, <span class="built_in">which</span> allows host-only access to the machine</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> using a specific IP.</span></span><br><span class="line">  config.vm.network &quot;private_network&quot;, ip: &quot;192.168.56.10&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Create a public network, <span class="built_in">which</span> generally matched to bridged network.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Bridged networks make the machine appear as another physical device on</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> your network.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> config.vm.network <span class="string">&quot;public_network&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Share an additional folder to the guest VM. The first argument is</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> the path on the host to the actual folder. The second argument is</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> the path on the guest to mount the folder. And the optional third</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> argument is a <span class="built_in">set</span> of non-required options.</span></span><br><span class="line">  config.vm.synced_folder &quot;C:/Users/wanghuan/Code/www&quot;, &quot;/data/www&quot;, create: true, owner: &quot;www&quot;, group: &quot;www&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Provider-specific configuration so you can fine-tune various</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> backing providers <span class="keyword">for</span> Vagrant. These expose provider-specific options.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Example <span class="keyword">for</span> VirtualBox:</span></span><br><span class="line"><span class="meta">  #</span></span><br><span class="line"><span class="bash">  config.vm.provider <span class="string">&quot;virtualbox&quot;</span> <span class="keyword">do</span> |vb|</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">   <span class="comment"># Display the VirtualBox GUI when booting the machine</span></span></span><br><span class="line"><span class="meta">  #</span><span class="bash">   vb.gui = <span class="literal">true</span></span></span><br><span class="line"><span class="meta">  #</span></span><br><span class="line"><span class="bash">  <span class="comment">#   # Customize the amount of memory on the VM:</span></span></span><br><span class="line">   vb.memory = &quot;2048&quot;</span><br><span class="line">   vb.cpus = 1</span><br><span class="line">   end</span><br><span class="line"><span class="meta">  #</span></span><br><span class="line"><span class="bash">  <span class="comment"># View the documentation for the provider you are using for more</span></span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> information on available options.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Enable provisioning with a shell script. Additional provisioners such as</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Ansible, Chef, Docker, Puppet and Salt are also available. Please see the</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> documentation <span class="keyword">for</span> more information about their specific syntax and use.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> config.vm.provision <span class="string">&quot;shell&quot;</span>, inline: &lt;&lt;-<span class="string">SHELL</span></span></span><br><span class="line"><span class="meta">  #</span><span class="bash">   apt-get update</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">   apt-get install -y apache2</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> SHELL</span></span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>配置git密钥</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成公钥私钥</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;lovenico2016@gmail.com&quot;</span></span><br><span class="line">     </span><br><span class="line"><span class="comment"># 配置git账号与绑定的邮箱</span></span><br><span class="line">git config --global user.name <span class="string">&quot;lovenico2016@gmail.com&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;Madoka-Kaname&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>启动虚拟机</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vagrant up</span><br></pre></td></tr></table></figure>
<h5 id="虚拟机的使用"><a href="#虚拟机的使用" class="headerlink" title="虚拟机的使用"></a>虚拟机的使用</h5></li>
<li><p>常用vagrant指令</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看虚拟机状态</span></span><br><span class="line">vagrant status</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 销毁虚拟机</span></span><br><span class="line">vagrant destroy </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 创建虚拟机</span></span><br><span class="line">vagrant up</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 重新加载虚拟机</span></span><br><span class="line">vagrant reload </span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入虚拟机</span></span><br><span class="line">vagrant ssh </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 重新应用新配置</span></span><br><span class="line">vagrant provision</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 按新配置启动</span></span><br><span class="line">vagrant up --provision</span><br></pre></td></tr></table></figure></li>
<li><p>用户</p>
  <figure class="highlight text"><table><tr><td class="code"><pre><span class="line"># vagrant用户和root密码都是vagrant</span><br><span class="line"># 默认使用vagrant用户登入虚拟机</span><br><span class="line"># 登入虚拟机后执行su root可切换为root用户</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="Homestead-Box-虚拟机盒子"><a href="#Homestead-Box-虚拟机盒子" class="headerlink" title="Homestead Box 虚拟机盒子"></a>Homestead Box 虚拟机盒子</h5><ul>
<li><a href="https://learnku.com/courses/laravel-essential-training/5.1/development-environment-windows/148#64f890">参考文档</a></li>
</ul>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>vagrant</tag>
      </tags>
  </entry>
  <entry>
    <title>解决Centos虚拟机有线网卡消失</title>
    <url>/2021/03/12/linux/2021-03-12-centos-network-manager.html</url>
    <content><![CDATA[<blockquote>
<p>centos系统虚拟机的有线网卡突然消失，导致网络无法连接</p>
</blockquote>
<a id="more"></a>

<h6 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h6><ul>
<li><p>进入虚拟机，在终端命令<code>systemctl start network.service</code>重启网络服务报以下错误(ens33为有线网卡,不同版本可能不同, 如ens32)</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Connection &#x27;ens33&#x27; is not available on device ens33 because device is strictly unmanaged</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h6 id="最佳解决"><a href="#最佳解决" class="headerlink" title="最佳解决"></a>最佳解决</h6><ul>
<li><p>关闭NetworkManager可以起作用，但不推荐，有线网卡消失是因为网卡未加入托管导致，这里重新纳入托管为最佳解决办法。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">查看托管状态</span><br><span class="line">nmcli n</span><br><span class="line">显示 disabled 则为本文遇到的问题，如果是 enabled 则可以不用往下看了</span><br><span class="line">开启 托管</span><br><span class="line">nmcli n on</span><br><span class="line">重启网络管理</span><br><span class="line">systemctl restart NetworkManager</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>centos</tag>
      </tags>
  </entry>
  <entry>
    <title>Node js环境安装和配置</title>
    <url>/2018/11/21/node/2022-11-21-node-install.html</url>
    <content><![CDATA[<blockquote>
<p>现在的前端开发已经离不开nodejs，其中的npm（或yarn）包管理工具更是带来很好的开发体验是。本文将简单介绍nodejs的安装及环境变量的配置，方便在更换电脑后重新配置node的查阅。</p>
</blockquote>
<h5 id="nodejs下载及安装"><a href="#nodejs下载及安装" class="headerlink" title="nodejs下载及安装"></a>nodejs下载及安装</h5><ul>
<li><p>下载node.js安装包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v16.18.0/node-v16.18.0-linux-x64.tar.xz</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压缩并安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -xvf node-v16.18.0-linux-x64.tar.xz</span><br><span class="line">mv node-v16.18.0-linux-x64/* /usr/<span class="built_in">local</span>/node</span><br><span class="line">rm -rf ./node-v16.18.0-linux-x64</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置node 环境变量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>追加环境变量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> NODE_HOME=/opt/node</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$NODE_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> NODE_PATH=<span class="variable">$PATH</span>:<span class="variable">$NODE_HOME</span>/lib/node_modules</span><br></pre></td></tr></table></figure>
</li>
<li><p>刷新环境变量, 使配置生效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看是否安装成功</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
</li>
<li><p>更换淘宝node镜像</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org </span><br><span class="line">npm config get registry </span><br></pre></td></tr></table></figure>
<h5 id="安装yarn等组件"><a href="#安装yarn等组件" class="headerlink" title="安装yarn等组件"></a>安装yarn等组件</h5></li>
<li><p>安装yarn</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g yarn</span><br><span class="line">yarn --version</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装vue-cli</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装<code>cnpm</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cnpm install</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>













</li>
</ul>
]]></content>
      <categories>
        <category>node js</category>
      </categories>
      <tags>
        <tag>node js</tag>
      </tags>
  </entry>
  <entry>
    <title>composer的安装和使用</title>
    <url>/2016/06/12/php/2016-06-12-composer.html</url>
    <content><![CDATA[<h2 id="安装composer"><a href="#安装composer" class="headerlink" title="安装composer"></a>安装<code>composer</code></h2><ul>
<li><p>版本要求<code>php &gt;= 5.4</code> </p>
</li>
<li><p><a href="http://docs.phpcomposer.com/">官方文档地址</a></p>
</li>
<li><p>终端指令安装</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ php -r <span class="string">&quot;copy(&#x27;https://install.phpcomposer.com/installer&#x27;, &#x27;composer-setup.php&#x27;);&quot;</span></span><br><span class="line"></span><br><span class="line">$ php composer-setup.php</span><br><span class="line"></span><br><span class="line">$ php -r <span class="string">&quot;unlink(&#x27;composer-setup.php&#x27;);&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>全局配置</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo mv composer.phar /usr/<span class="built_in">local</span>/bin/composer</span><br></pre></td></tr></table></figure>
</li>
<li><p>更换镜像加速源</p>
<ul>
<li><p><code>packagist</code>中文镜像</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer config -g repo.packagist composer https://packagist.phpcomposer.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>阿里云镜像</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/</span><br></pre></td></tr></table></figure>
</li>
<li><p>腾讯云镜像</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer config -g repos.packagist composer https://mirrors.cloud.tencent.com/composer/</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="使用composer"><a href="#使用composer" class="headerlink" title="使用composer"></a>使用<code>composer</code></h2><ul>
<li><p>添加包</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer require <span class="string">&quot;foo/bar:1.0.0&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>移除包</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer require foo/bar</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新加载配置</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer dump-autoload</span><br></pre></td></tr></table></figure>
</li>
<li><p>升级和降级</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer self-update 2.0.13</span><br><span class="line">$ composer self-update 1.10.21</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>php扩展库安装</title>
    <url>/2017/09/21/php/2017-09-21-php-extensions.html</url>
    <content><![CDATA[<a id="more"></a>

<h3 id="windows环境下PHP安装扩展"><a href="#windows环境下PHP安装扩展" class="headerlink" title="windows环境下PHP安装扩展"></a>windows环境下PHP安装扩展</h3><ul>
<li><p>通过phpinfo()函数，进行查看扩展是否已安装</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据php版本前往官方网址下载对应的扩展库</p>
<p><a href="http://pecl.php.net/packages.php">下载地址</a></p>
<p>windows对应<code>dll</code>， nts非线程安全，ts线程安全，x64代表64位，x86代表32位。</p>
</li>
<li><p>将下载的扩展库文件放入对应的扩展库文件夹，修改php.ini, 以下以redis为例</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">extension=php_igbinary.dll</span><br><span class="line">extension=php_redis.dll</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="linux-centos-redhat-环境下PHP安装扩展"><a href="#linux-centos-redhat-环境下PHP安装扩展" class="headerlink" title="linux(centos/redhat)环境下PHP安装扩展"></a>linux(centos/redhat)环境下PHP安装扩展</h3><h6 id="方法一-源码安装"><a href="#方法一-源码安装" class="headerlink" title="方法一: 源码安装"></a>方法一: 源码安装</h6><ol>
<li><p>下载php版本对应的扩展源码包</p>
<ul>
<li><p>例如redis</p>
<p><code>http://pecl.php.net/package/redis</code></p>
</li>
</ul>
</li>
<li><p>解压进入源码目录</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tar -zxvf redis.tar.gz</span><br><span class="line">   </span><br><span class="line">$ <span class="built_in">cd</span> redis</span><br><span class="line">   </span><br><span class="line">$ /usr/bin/phpize </span><br><span class="line">   </span><br><span class="line">$ ./configure --with-php-config=/usr/bin/php-config</span><br><span class="line">   </span><br><span class="line">$ make &amp;&amp; make install</span><br><span class="line">   </span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;extension=redis.so&quot;</span> &gt;&gt; /etc/php.ini</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h6 id="方法二-pecl扩展库安装"><a href="#方法二-pecl扩展库安装" class="headerlink" title="方法二: pecl扩展库安装"></a>方法二: pecl扩展库安装</h6><ul>
<li><p>终端执行指令</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pecl install -o -f redis </span><br><span class="line">  </span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;extension=redis.so&quot;</span> &gt;&gt; /etc/php.ini</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>使用php接入app支付</title>
    <url>/2016/06/12/php/2021-03-10-app-pay.html</url>
    <content><![CDATA[<blockquote>
<p>使用php语言接入支付宝和微信的app支付, 基于<code>yansongda/pay</code>扩展包(非laravel版本) v2版本, laravel框架有单独的版本和使用方式</p>
</blockquote>
<a id="more"></a>

<h6 id="文档地址"><a href="#文档地址" class="headerlink" title="文档地址"></a>文档地址</h6><p><a href="https://pay.yansongda.cn/docs/v2/">https://pay.yansongda.cn/docs/v2/</a></p>
<h6 id="github地址"><a href="#github地址" class="headerlink" title="github地址"></a>github地址</h6><p><a href="https://github.com/yansongda/pay">https://github.com/yansongda/pay</a></p>
<h6 id="支付宝配置"><a href="#支付宝配置" class="headerlink" title="支付宝配置"></a>支付宝配置</h6><p>具体商户如何申请移动应用和绑定参考<a href="https://www.jianshu.com/p/c15db5fb187b">这里</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Yansongda</span>\<span class="title">Pay</span>\<span class="title">Pay</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Yansongda</span>\<span class="title">Pay</span>\<span class="title">Log</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$config</span> = [</span><br><span class="line">        <span class="string">&#x27;app_id&#x27;</span> =&gt; <span class="string">&#x27;2016082000295641&#x27;</span>,      <span class="comment">// 申请的移动应用appid</span></span><br><span class="line">        <span class="string">&#x27;notify_url&#x27;</span> =&gt; <span class="string">&#x27;http://yansongda.cn/notify.php&#x27;</span>,  <span class="comment">// 异步回调地址</span></span><br><span class="line">        <span class="string">&#x27;return_url&#x27;</span> =&gt; <span class="string">&#x27;http://yansongda.cn/return.php&#x27;</span>,  <span class="comment">// 同步回调地址 一般不用</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ali_public_key是支付公钥， 不是应用公钥</span></span><br><span class="line">        <span class="string">&#x27;ali_public_key&#x27;</span> =&gt; <span class="string">&#x27;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuWJKrQ6SWvS6niI+4vEVZiYfjkCfLQfoFI2nCp9ZLDS42QtiL4Ccyx8scgc3nhVwmVRte8f57TFvGhvJD0upT4O5O/lRxmTjechXAorirVdAODpOu0mFfQV9y/T9o9hHnU+VmO5spoVb3umqpq6D/Pt8p25Yk852/w01VTIczrXC4QlrbOEe3sr1E9auoC7rgYjjCO6lZUIDjX/oBmNXZxhRDrYx4Yf5X7y8FRBFvygIE2FgxV4Yw+SL3QAa2m5MLcbusJpxOml9YVQfP8iSurx41PvvXUMo49JG3BDVernaCYXQCoUJv9fJwbnfZd7J5YByC+5KM4sblJTq7bXZWQIDAQAB&#x27;</span>,</span><br><span class="line">        <span class="comment">// 加密方式： **RSA2**  </span></span><br><span class="line">        <span class="string">&#x27;private_key&#x27;</span> =&gt; <span class="string">&#x27;MIIEpAIBAAKCAQEAs6+F2leOgOrvj9jTeDhb5q46GewOjqLBlGSs/bVL4Z3fMr3p+Q1Tux/6uogeVi/eHd84xvQdfpZ87A1SfoWnEGH5z15yorccxSOwWUI+q8gz51IWqjgZxhWKe31BxNZ+prnQpyeMBtE25fXp5nQZ/pftgePyUUvUZRcAUisswntobDQKbwx28VCXw5XB2A+lvYEvxmMv/QexYjwKK4M54j435TuC3UctZbnuynSPpOmCu45ZhEYXd4YMsGMdZE5/077ZU1aU7wx/gk07PiHImEOCDkzqsFo0Buc/knGcdOiUDvm2hn2y1XvwjyFOThsqCsQYi4JmwZdRa8kvOf57nwIDAQABAoIBAQCw5QCqln4VTrTvcW+msB1ReX57nJgsNfDLbV2dG8mLYQemBa9833DqDK6iynTLNq69y88ylose33o2TVtEccGp8Dqluv6yUAED14G6LexS43KtrXPgugAtsXE253ZDGUNwUggnN1i0MW2RcMqHdQ9ORDWvJUCeZj/AEafgPN8AyiLrZeL07jJz/uaRfAuNqkImCVIarKUX3HBCjl9TpuoMjcMhz/MsOmQ0agtCatO1eoH1sqv5Odvxb1i59c8Hvq/mGEXyRuoiDo05SE6IyXYXr84/Nf2xvVNHNQA6kTckj8shSi+HGM4mO1Y4Pbb7XcnxNkT0Inn6oJMSiy56P+CpAoGBAO1O+5FE1ZuVGuLb48cY+0lHCD+nhSBd66B5FrxgPYCkFOQWR7pWyfNDBlmO3SSooQ8TQXA25blrkDxzOAEGX57EPiipXr/hy5e+WNoukpy09rsO1TMsvC+v0FXLvZ+TIAkqfnYBgaT56ku7yZ8aFGMwdCPL7WJYAwUIcZX8wZ3dAoGBAMHWplAqhe4bfkGOEEpfs6VvEQxCqYMYVyR65K0rI1LiDZn6Ij8fdVtwMjGKFSZZTspmsqnbbuCE/VTyDzF4NpAxdm3cBtZACv1Lpu2Om+aTzhK2PI6WTDVTKAJBYegXaahBCqVbSxieR62IWtmOMjggTtAKWZ1P5LQcRwdkaB2rAoGAWnAPT318Kp7YcDx8whOzMGnxqtCc24jvk2iSUZgb2Dqv+3zCOTF6JUsV0Guxu5bISoZ8GdfSFKf5gBAo97sGFeuUBMsHYPkcLehM1FmLZk1Q+ljcx3P1A/ds3kWXLolTXCrlpvNMBSN5NwOKAyhdPK/qkvnUrfX8sJ5XK2H4J8ECgYAGIZ0HIiE0Y+g9eJnpUFelXvsCEUW9YNK4065SD/BBGedmPHRC3OLgbo8X5A9BNEf6vP7fwpIiRfKhcjqqzOuk6fueA/yvYD04v+Da2MzzoS8+hkcqF3T3pta4I4tORRdRfCUzD80zTSZlRc/h286Y2eTETd+By1onnFFe2X01mwKBgQDaxo4PBcLL2OyVT5DoXiIdTCJ8KNZL9+kV1aiBuOWxnRgkDjPngslzNa1bK+klGgJNYDbQqohKNn1HeFX3mYNfCUpuSnD2Yag53Dd/1DLO+NxzwvTu4D6DCUnMMMBVaF42ig31Bs0jI3JQZVqeeFzSET8fkoFopJf3G6UXlrIEAQ==&#x27;</span>,</span><br><span class="line">        <span class="comment">// 使用公钥证书模式，请配置下面两个参数，同时修改ali_public_key为以.crt结尾的支付宝公钥证书路径，如（./cert/alipayCertPublicKey_RSA2.crt）</span></span><br><span class="line">        <span class="comment">// &#x27;app_cert_public_key&#x27; =&gt; &#x27;./cert/appCertPublicKey.crt&#x27;, //应用公钥证书路径</span></span><br><span class="line">        <span class="comment">// &#x27;alipay_root_cert&#x27; =&gt; &#x27;./cert/alipayRootCert.crt&#x27;, //支付宝根证书路径</span></span><br><span class="line">        <span class="string">&#x27;log&#x27;</span> =&gt; [ <span class="comment">// optional</span></span><br><span class="line">            <span class="string">&#x27;file&#x27;</span> =&gt; <span class="string">&#x27;./logs/alipay.log&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span> =&gt; <span class="string">&#x27;info&#x27;</span>, <span class="comment">// 建议生产环境等级调整为 info，开发环境为 debug</span></span><br><span class="line">            <span class="string">&#x27;type&#x27;</span> =&gt; <span class="string">&#x27;single&#x27;</span>, <span class="comment">// optional, 可选 daily.</span></span><br><span class="line">            <span class="string">&#x27;max_file&#x27;</span> =&gt; <span class="number">30</span>, <span class="comment">// optional, 当 type 为 daily 时有效，默认 30 天</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;http&#x27;</span> =&gt; [ <span class="comment">// optional</span></span><br><span class="line">            <span class="string">&#x27;timeout&#x27;</span> =&gt; <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">&#x27;connect_timeout&#x27;</span> =&gt; <span class="number">5.0</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;mode&#x27;</span> =&gt; <span class="string">&#x27;dev&#x27;</span>, <span class="comment">// optional,设置此参数，将进入沙箱模式</span></span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成支付签名和参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$order</span> = [</span><br><span class="line">            <span class="string">&#x27;out_trade_no&#x27;</span> =&gt; <span class="string">&#x27;213213211312&#x27;</span>,  <span class="comment">// 商户自己生成的内部唯一支付单号</span></span><br><span class="line">            <span class="string">&#x27;total_amount&#x27;</span> =&gt; <span class="string">&#x27;0.01&#x27;</span>,  <span class="comment">// 支付金额 单位元</span></span><br><span class="line">            <span class="string">&#x27;subject&#x27;</span> =&gt; <span class="string">&#x27;test subject - 测试&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Pay::alipay(<span class="keyword">$this</span>-&gt;config)-&gt;app(<span class="variable">$order</span>)-&gt;getContent();</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 异步回调</span></span><br><span class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 验签</span></span><br><span class="line">        <span class="variable">$alipay</span> = Pay::alipay(<span class="keyword">$this</span>-&gt;config);</span><br><span class="line">        <span class="variable">$data</span>   = <span class="variable">$alipay</span>-&gt;verify();</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$out_trade_no</span>   = <span class="variable">$data</span>-&gt;out_trade_no;  <span class="comment">// 商户自己生成的内部唯一支付单号</span></span><br><span class="line">        <span class="variable">$total_amount</span>   = <span class="variable">$data</span>-&gt;total_amount;     <span class="comment">// 支付金额 单位元</span></span><br><span class="line">        <span class="variable">$trade_no</span>       = <span class="variable">$data</span>-&gt;trade_no;  <span class="comment">// 交易流水号</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发起退款申请</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">refund</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$refund_data</span> = [</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>           =&gt; <span class="string">&#x27;app&#x27;</span>,  <span class="comment">// 标识为app 必填为app</span></span><br><span class="line">            <span class="string">&#x27;trade_no&#x27;</span>       =&gt; <span class="string">&#x27;2020123121212&#x27;</span>, <span class="comment">// 原支付交易流水号</span></span><br><span class="line">            <span class="string">&#x27;out_request_no&#x27;</span> =&gt; <span class="string">&#x27;3213213131213&#x27;</span>,  <span class="comment">// 商户自己生成的内部唯一退款单号</span></span><br><span class="line">            <span class="string">&#x27;refund_amount&#x27;</span>  =&gt; <span class="string">&#x27;0.01&#x27;</span>,  <span class="comment">// 退款金额 单位元</span></span><br><span class="line">        ];</span><br><span class="line">        <span class="variable">$result</span> =  Pay::alipay(<span class="keyword">$this</span>-&gt;config)-&gt;refund(<span class="variable">$refund_data</span>);</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$result</span>-&gt;code !== <span class="string">&#x27;10000&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 接口调用失败</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">Exception</span>(<span class="variable">$result</span>-&gt;msg);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 接口调用成功</span></span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 退款查询</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">query_refund</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = [ </span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>           =&gt; <span class="string">&#x27;app&#x27;</span>, <span class="comment">// 标识为app 必填为app</span></span><br><span class="line">            <span class="string">&#x27;out_trade_no&#x27;</span>   =&gt; <span class="string">&#x27;213213211312&#x27;</span>, <span class="comment">// 原支付订单的内部唯一单号</span></span><br><span class="line">            <span class="string">&#x27;out_request_no&#x27;</span> =&gt; <span class="string">&#x27;3213213131213&#x27;</span>,  <span class="comment">// 商户自己生成的内部唯一退款单号</span></span><br><span class="line">        ];</span><br><span class="line">        <span class="variable">$result</span> = Pay::alipay(<span class="keyword">$this</span>-&gt;config)-&gt;find(<span class="variable">$data</span>, <span class="string">&#x27;refund&#x27;</span>);   </span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$result</span>-&gt;code !== <span class="string">&#x27;10000&#x27;</span>)&#123;</span><br><span class="line">            <span class="comment">// 未查到或者到账失败</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 查到到账信息</span></span><br><span class="line">            <span class="variable">$trade_no</span> = <span class="variable">$result</span>-&gt;trade_no;  <span class="comment">// 退款交易单号</span></span><br><span class="line">            <span class="variable">$money</span> = <span class="variable">$result</span>-&gt;refund_amount;  <span class="comment">// 退款金额 单位元</span></span><br><span class="line">        &#125;              </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="微信支付配置"><a href="#微信支付配置" class="headerlink" title="微信支付配置"></a>微信支付配置</h6><ul>
<li>具体如何申请商户号和app支付功能参考<a href="https://jingyan.baidu.com/article/02027811706ea61bcd9ce54c.html">这里</a></li>
<li>具体配置参考<a href="https://app.applebyme.cn/doc/guide/wxpay.cshtml">这里</a></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Yansongda</span>\<span class="title">Pay</span>\<span class="title">Pay</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Yansongda</span>\<span class="title">Pay</span>\<span class="title">Log</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$config</span> = [</span><br><span class="line">        <span class="string">&#x27;appid&#x27;</span> =&gt; <span class="string">&#x27;wxb3fxxxxxxxxxxx&#x27;</span>, <span class="comment">// APP APPID</span></span><br><span class="line">        <span class="comment">//&#x27;app_id&#x27; =&gt; &#x27;wxb3fxxxxxxxxxxx&#x27;, // 公众号 APPID</span></span><br><span class="line">        <span class="comment">//&#x27;miniapp_id&#x27; =&gt; &#x27;wxb3fxxxxxxxxxxx&#x27;, // 小程序 APPID</span></span><br><span class="line">        <span class="string">&#x27;mch_id&#x27;</span> =&gt; <span class="string">&#x27;14577xxxx&#x27;</span>,  <span class="comment">// 支付商户号id</span></span><br><span class="line">        <span class="string">&#x27;key&#x27;</span> =&gt; <span class="string">&#x27;mF2suE9sU6Mk1Cxxxxxxxxxxx&#x27;</span>,  <span class="comment">// api支付秘钥</span></span><br><span class="line">        <span class="string">&#x27;notify_url&#x27;</span> =&gt; <span class="string">&#x27;http://yanda.net.cn/notify.php&#x27;</span>,  <span class="comment">// 异步回调地址</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">// api支付证书</span></span><br><span class="line">        <span class="string">&#x27;cert_client&#x27;</span> =&gt; <span class="string">&#x27;./cert/apiclient_cert.pem&#x27;</span>, <span class="comment">// optional，退款等情况时用到</span></span><br><span class="line">        <span class="string">&#x27;cert_key&#x27;</span> =&gt; <span class="string">&#x27;./cert/apiclient_key.pem&#x27;</span>,<span class="comment">// optional，退款等情况时用到</span></span><br><span class="line">    </span><br><span class="line">        <span class="string">&#x27;log&#x27;</span> =&gt; [ <span class="comment">// optional</span></span><br><span class="line">            <span class="string">&#x27;file&#x27;</span> =&gt; <span class="string">&#x27;./logs/wechat.log&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span> =&gt; <span class="string">&#x27;info&#x27;</span>, <span class="comment">// 建议生产环境等级调整为 info，开发环境为 debug</span></span><br><span class="line">            <span class="string">&#x27;type&#x27;</span> =&gt; <span class="string">&#x27;single&#x27;</span>, <span class="comment">// optional, 可选 daily.</span></span><br><span class="line">            <span class="string">&#x27;max_file&#x27;</span> =&gt; <span class="number">30</span>, <span class="comment">// optional, 当 type 为 daily 时有效，默认 30 天</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;http&#x27;</span> =&gt; [ <span class="comment">// optional</span></span><br><span class="line">            <span class="string">&#x27;timeout&#x27;</span> =&gt; <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">&#x27;connect_timeout&#x27;</span> =&gt; <span class="number">5.0</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;mode&#x27;</span> =&gt; <span class="string">&#x27;dev&#x27;</span>, <span class="comment">// optional, dev/hk;当为 `hk` 时，为香港 gateway。</span></span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成支付签名和参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$order</span> = [</span><br><span class="line">            <span class="string">&#x27;out_trade_no&#x27;</span> =&gt; <span class="string">&#x27;213213211312&#x27;</span>,  <span class="comment">// 商户自己生成的内部唯一支付单号</span></span><br><span class="line">            <span class="string">&#x27;total_fee&#x27;</span> =&gt; <span class="string">&#x27;1&#x27;</span>,  <span class="comment">// 支付金额 单位分</span></span><br><span class="line">            <span class="string">&#x27;body&#x27;</span> =&gt; <span class="string">&#x27;test subject - 测试&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Pay::wechat(<span class="keyword">$this</span>-&gt;config)-&gt;app(<span class="variable">$order</span>)-&gt;getContent();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 异步回调</span></span><br><span class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 验签</span></span><br><span class="line">        <span class="variable">$wechat</span> = Pay::wechat(<span class="keyword">$this</span>-&gt;config);</span><br><span class="line">        <span class="variable">$data</span>   = <span class="variable">$wechat</span>-&gt;verify();</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$out_trade_no</span>   = <span class="variable">$data</span>-&gt;out_trade_no;  <span class="comment">// 商户自己生成的内部唯一支付单号</span></span><br><span class="line">        <span class="variable">$total_fee</span>      = <span class="variable">$data</span>-&gt;total_fee;     <span class="comment">// 支付金额 单位分</span></span><br><span class="line">        <span class="variable">$transaction_id</span> = <span class="variable">$data</span>-&gt;transaction_id;  <span class="comment">// 交易流水号</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发起退款申请</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">refund</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$refund_data</span> = [</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>           =&gt; <span class="string">&#x27;app&#x27;</span>,  <span class="comment">// 标识为app 必填为app</span></span><br><span class="line">            <span class="string">&#x27;transaction_id&#x27;</span> =&gt; <span class="string">&#x27;2020123121212&#x27;</span>, <span class="comment">// 原支付交易流水号</span></span><br><span class="line">            <span class="string">&#x27;out_refund_no&#x27;</span>  =&gt; <span class="string">&#x27;3213213131213&#x27;</span>,  <span class="comment">// 商户自己生成的内部唯一退款单号</span></span><br><span class="line">            <span class="string">&#x27;refund_fee&#x27;</span>     =&gt; <span class="string">&#x27;1&#x27;</span>,  <span class="comment">// 退款金额 单位分</span></span><br><span class="line">            <span class="string">&#x27;total_fee&#x27;</span>      =&gt; <span class="string">&#x27;1&#x27;</span>,  <span class="comment">// 原支付金额 单位分</span></span><br><span class="line">            <span class="string">&#x27;refund_desc&#x27;</span>    =&gt; <span class="string">&#x27;退款测试&#x27;</span>,  </span><br><span class="line">        ];</span><br><span class="line">        <span class="variable">$result</span> =  Pay::wechat(<span class="keyword">$this</span>-&gt;config)-&gt;refund(<span class="variable">$refund_data</span>);</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$result</span>-&gt;return_code !== <span class="string">&#x27;SUCCESS&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 接口调用失败</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">Exception</span>(<span class="variable">$result</span>-&gt;return_msg);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 接口调用成功</span></span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 退款查询</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">query_refund</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = [ </span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>           =&gt; <span class="string">&#x27;app&#x27;</span>, <span class="comment">// 标识为app 必填为app</span></span><br><span class="line">            <span class="string">&#x27;out_refund_no&#x27;</span>  =&gt; <span class="string">&#x27;3213213131213&#x27;</span>,  <span class="comment">// 商户自己生成的内部唯一退款单号</span></span><br><span class="line">        ];</span><br><span class="line">        <span class="variable">$result</span> = Pay::wechat(<span class="keyword">$this</span>-&gt;config)-&gt;find(<span class="variable">$data</span>, <span class="string">&#x27;refund&#x27;</span>);   </span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$result</span>-&gt;return_code !== <span class="string">&#x27;SUCCESS&#x27;</span>)&#123;</span><br><span class="line">            <span class="comment">// 未查到或者到账失败</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 查到到账信息 多笔根据下标取, 下标从0开始</span></span><br><span class="line">            <span class="variable">$trade_no</span> = <span class="variable">$result</span>-&gt;refund_id_0;  <span class="comment">// 退款交易单号</span></span><br><span class="line">            <span class="variable">$money</span> = <span class="variable">$result</span>-&gt;refund_fee_0;  <span class="comment">// 退款金额 单位分</span></span><br><span class="line">        &#125;              </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>app</tag>
      </tags>
  </entry>
  <entry>
    <title>svn版本管理工具</title>
    <url>/2017/06/01/tools/2017-06-01-svn-manage.html</url>
    <content><![CDATA[<blockquote>
<p>svn</p>
</blockquote>
<h5 id="搭建svn服务"><a href="#搭建svn服务" class="headerlink" title="搭建svn服务"></a>搭建svn服务</h5><ul>
<li><p>yum安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install subversion</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建仓库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /home/subversion</span><br><span class="line">svnadmin create /home/subversion/yjy_api</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="配置仓库权限和钩子"><a href="#配置仓库权限和钩子" class="headerlink" title="配置仓库权限和钩子"></a>配置仓库权限和钩子</h5><ul>
<li>修改</li>
</ul>
]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>svn</tag>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>git版本管理工具</title>
    <url>/2017/06/02/tools/2017-06-02-git-manage.html</url>
    <content><![CDATA[<blockquote>
<p>git</p>
</blockquote>
<h5 id="搭建git服务"><a href="#搭建git服务" class="headerlink" title="搭建git服务"></a>搭建git服务</h5><h5 id="安装git客户端"><a href="#安装git客户端" class="headerlink" title="安装git客户端"></a>安装git客户端</h5><ul>
<li>在centos系统  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install git</span><br><span class="line">git --version</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="git指令"><a href="#git指令" class="headerlink" title="git指令"></a>git指令</h5><ul>
<li><p>常用</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 拉取远程仓库代码(默认分支)</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:Madoka-Kaname/Madoka-Kaname.github.io.git</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 拉取远程仓库指定分支</span></span><br><span class="line">git checkout -b main origin/main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送远程仓库指定分支</span></span><br><span class="line"><span class="comment"># git push origin main</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 强行推送远程仓库</span></span><br><span class="line"><span class="comment"># git push --force origin main</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 显示所有远程仓库包括url</span></span><br><span class="line">git remote -v</span><br></pre></td></tr></table></figure>
<h1 id="查看提交信息"><a href="#查看提交信息" class="headerlink" title="查看提交信息"></a>查看提交信息</h1><p>  git log </p>
<h1 id="默认推送方式"><a href="#默认推送方式" class="headerlink" title="默认推送方式"></a>默认推送方式</h1><p>  git config –global push.default simple</p>
<h1 id="拉取分支"><a href="#拉取分支" class="headerlink" title="拉取分支"></a>拉取分支</h1><p>  git pull –rebase origin master</p>
<h1 id="强推分支"><a href="#强推分支" class="headerlink" title="强推分支"></a>强推分支</h1><p>  git push -u origin master</p>
</li>
</ul>
<h5 id="开发工作流"><a href="#开发工作流" class="headerlink" title="开发工作流"></a>开发工作流</h5><ul>
<li><p>merge方式</p>
<p>优点:方便管理, 安全性高, 可追溯, 适合小团队<br>缺点:步骤繁琐, 结构复杂, 过多的合并线, 不易代码审查</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 合并master到feature分支</span></span><br><span class="line">git checkout feature</span><br><span class="line">git merge master </span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">git merge feature master</span><br></pre></td></tr></table></figure>
</li>
<li><p>rebase方式</p>
<p>优点:结构清晰, 方便代码审查, 适合大团队<br>缺点:需要合理管理, 不遵守rebase的黄金法则容易丢失了合并提交能够提供的上下文信息</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 把feature分支的提交历史rebase到main分支的提交历史顶端</span></span><br><span class="line">git checkout feature</span><br><span class="line">git rebase main</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 可交互式rebase</span></span><br><span class="line">git checkout feature</span><br><span class="line">git rebase -i main</span><br><span class="line">  执行以上命令会打开一个文本编辑器，其中内容为分支中需要移动的所有提交列表</span><br><span class="line">pick 33d5b7a Message <span class="keyword">for</span> commit <span class="comment">#1</span></span><br><span class="line">pick 9480b3d Message <span class="keyword">for</span> commit <span class="comment">#2</span></span><br><span class="line">pick 5c67e61 Message <span class="keyword">for</span> commit <span class="comment">#3</span></span><br><span class="line">  使用fixup命令替代pick来把两次提交压缩在一起</span><br><span class="line">pick 33d5b7a Message <span class="keyword">for</span> commit <span class="comment">#1</span></span><br><span class="line">fixup 9480b3d Message <span class="keyword">for</span> commit <span class="comment">#2</span></span><br><span class="line">pick 5c67e61 Message <span class="keyword">for</span> commit <span class="comment">#3</span></span><br><span class="line">  保存并关闭这个文件之后，Git会根据你的调改结果执行rebase操作</span><br><span class="line">    </span><br><span class="line"><span class="comment"># rebase操作黄金法则:永远不要在公共分支上使用它</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h5><ul>
<li><a href="https://www.zhihu.com/question/36509119/answer/2423381574">git工作流</a></li>
</ul>
]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>php基础面试题整理</title>
    <url>/2020/07/10/tools/2020-07-10-php-base-qa.html</url>
    <content><![CDATA[<h5 id="语法部分"><a href="#语法部分" class="headerlink" title="语法部分"></a>语法部分</h5><ul>
<li><p>isset()和empty区别</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">isset检查变量是否存在且不为NULL, empty()检查一个变量是否为空.</span><br><span class="line">isset检查值为NULL的变量为false, empty检查为0相关的变量为false.</span><br></pre></td></tr></table></figure>
</li>
<li><p>error_reporting作用</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">设置当前程序的错误报告级别</span><br></pre></td></tr></table></figure>
</li>
<li><p>session和cookie区别</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">都是用于跟踪用户的整个会话, SESSION存储在服务器端, COOKIE保存在客户端, </span><br><span class="line">SESSION相对来说更安全.</span><br></pre></td></tr></table></figure>
</li>
<li><p>get和post区别</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">GET是通过URL传递参数的, 只能进行URL编码, GET传送的参数长度也是有限制, </span><br><span class="line">不适合传递敏感数据.</span><br><span class="line">POST是通过REQUEST BODY传递参数, 支持多种编码方式, 对参数长度没有限制, </span><br><span class="line">对传递的参数数据类型没有限制.</span><br></pre></td></tr></table></figure></li>
<li><p>include和require区别</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">include加载脚本文件不存在时不会报错, require会报致命错误, 中断程序, </span><br><span class="line">有once后缀的会判断当前载入的脚本文件是否已经载入过, 如果载入了就不再执行.</span><br></pre></td></tr></table></figure>
</li>
<li><p>转义字符有哪些</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">addslashes():在预定义的字符(双引号、单引号、反斜杠、NULL)前添加反斜杠的字符串.</span><br><span class="line">strip_tags():会过滤掉NULL, HTML和PHP标签.</span><br><span class="line">htmlspecialchars:转义html内容.</span><br></pre></td></tr></table></figure>
</li>
<li><p>什么是面向对象, 面向对象的主要特征是什么?</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">面向对象一个编程思想, 把具体事物属性和联系映射为对象.</span><br><span class="line">特征:封装性(无需知道具体怎么实现, 可以重复使用), 继承性: 类于类之间可以继承, </span><br><span class="line">便于增加新功能. 多态性: 继承的类可以复写父类的类型和方法.</span><br></pre></td></tr></table></figure></li>
<li><p>什么是类, 类的主要特征是什么?</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">具有共性事务的代表.</span><br><span class="line">特征:封装性(无需知道具体怎么实现, 可以重复使用), 继承性: 类于类之间可以继承, </span><br><span class="line">便于增加新功能. 多态性: 继承的类可以复写父类的类型和方法.</span><br></pre></td></tr></table></figure>
</li>
<li><p>设计模式</p>
<ul>
<li><p>单例模式: 三私一公, 私有的静态变量, 私有的构造方法, 私有的克隆方法,<br>公有的静态方法. 主要应用场景:数据库连接.</p>
</li>
<li><p>工厂模式: 提供一种类, 具有为您创建对象的某些方法, 这样就可以使用工厂类创建对象,<br>而不直接使用new. 主要应用场景: 用来解析路由, 加载对应的控制器文件.</p>
</li>
<li><p>注册模式: 注册树模式通过将对象实例注册到一棵全局的对象容器上，需要的时候从容器上<br>拿对应的对象.</p>
</li>
<li><p>策略模式: 定义一系列算法, 把它们一个个封装起来, 并且使它们可相互替换.</p>
</li>
<li><p>观察者模式:当一个对象状态发生变化时, 依赖它的对象全部会收到通知, 并自动更新.<br>主要应用场景:模型监听.</p>
</li>
</ul>
</li>
</ul>
<h5 id="框架部分"><a href="#框架部分" class="headerlink" title="框架部分"></a>框架部分</h5><ul>
<li><p>laravel生命周期</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">入口文件public/index.php文件, 入口文件里是自动加载和bootstrap/app.php启动文件, </span><br><span class="line">启动文件返回一个应用容器实例, 根据请求类型, 应用容器创建请求核心, 入口文件里是生成HTTP请求核心,</span><br><span class="line">生成http kernel时候会引导配置异常处理、配置日志、中间件、加载服务提供者等, 其中服务提供者包含</span><br><span class="line">路由、验证、数据库、队列等。请求核心并返回响应结果并调用send方法发送给客户端, 最后容器会结束这次请求和响应。</span><br></pre></td></tr></table></figure>
</li>
<li><p>自动加载怎么去实现</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">魔术方法__autoload()</span><br></pre></td></tr></table></figure>
</li>
<li><p>composer的功能和实现</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">composer处理包的管理和依赖的工具.</span><br><span class="line">通过使用配置文件composer.json文件完成依赖管理, vendor/autoload.php自动加载.</span><br></pre></td></tr></table></figure>
</li>
<li><p>mvc</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Model模型层:数据库交互</span><br><span class="line">View视图层:渲染数据到页面</span><br><span class="line">Controller控制器层:处理用户交互和处理逻辑, 沟通模型和视图.</span><br><span class="line">优点:低耦合, 重用性高, 容易维护</span><br><span class="line">缺点:增加了结构复杂度, 控制器和视图联系密切        </span><br></pre></td></tr></table></figure>
</li>
<li><p>依赖注入</p>
<pre><code class="text">
d```
</code></pre>
</li>
</ul>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
</search>
